---
title: "RF31: Usuario modifica parámetros de fórmulas."  
sidebar_position: 32
---

# RF31: Usuario modifica parámetros de fórmulas.

### Historia de Usuario

Yo como usuario quiero tener la capacidad de cambiar los parámetros (columnas de excel ej: Gasolina) de una fórmula.

  **Precondiciones:**
  - Haber creado una formula.
  - Consultar las formulas disponibles.

  **Dependencias:**
  - RF2: Usuario registrado inicia sesión.
  - RF21: Usuario consulta fórmulas.
  - RF22: Usuario guarda fórmula.

  **Criterios de Aceptación:**
  - El sistema debe permitir modificar el nombre de la fórmula.
  - El límite de caracteres para el nombre es de 50.
  - El sistema debe permitir modificar los valores de la fórmula.
  - El límite de caracteres para la fórmula es de 512.
  - Los campos de entrada no permiten inyecciones de código.
  - El sistema debe notificar al usuario si no se pudo hacer la modificación.
  - Los parámetros de la fórmula (Si, Contar, Buscar, etc.) están en inglés debido a la librería hyperformula.
  - El sistema debe notificar visualmente al usuario si no se ha modificado nada.
  - El usuario puede cancelar los cambios en cualquier momento.
  - El sistema debe notificar visualmente al usuario cuando la operación es exitosa.

---

### Diagrama de Secuencia

``` mermaid
sequenceDiagram
    actor Usuario
    participant view as modificarFormula.ejs
    participant utilFormula as modificarFormula.js
    participant usecase as casosUso/formulas/modificarFormula.js
    participant formulaAPI as formulaApi.js
    participant server as BackendDesacoplado

    activate Usuario
    Usuario->>utilFormula: Cambiar valores de fórmula
    activate utilFormula
    utilFormula->>utilFormula: confirmacion()
    utilFormula->>usecase: modificarFormulaCasoUso()
    deactivate utilFormula
    activate usecase
    usecase-)formulaAPI: modificarFormula()
    deactivate usecase
    activate formulaAPI
    formulaAPI-)server: modificarFormula()
    activate server
    alt Caso exitoso
      rect Lightgreen
      server-->>formulaAPI: reponse('mensaje')
      deactivate server
      formulaAPI-->>usecase: response('mensaje')
      deactivate formulaAPI
      activate usecase
      usecase-->>utilFormula: response('mensaje')
      deactivate usecase
      activate utilFormula
      utilFormula->>view: Render
      deactivate utilFormula
      activate view
      view->>Usuario: HTML
      deactivate view
      end
    else Error al cambiar los valores
      rect Lightcoral
      server-->>formulaAPI: reponse('error')
      activate formulaAPI
      formulaAPI-->>usecase: response('error')
      deactivate formulaAPI
      activate usecase
      usecase-->>utilFormula: response('error')
      deactivate usecase
      activate utilFormula
      utilFormula->>view: Render
      deactivate utilFormula
      activate view
      view->>Usuario: HTML
      deactivate view
      end
    else Guardar sin hacer cambios
    rect Lightcoral
      utilFormula->>view: response('error')
      activate view
      view->>Usuario: HTML
      deactivate view
      end
    end
    deactivate Usuario
```

---

### Mockup

![Mockup](./mockups/modificarFormula.png)

> *Descripción*: El mockup representa la interfaz del sistema donde el usuario puede modificar los parámetros de la fórmula. 

---

### Pruebas Unitarias 
  - [Pruebas](https://docs.google.com/spreadsheets/d/1W-JW32dTsfI22-Yl5LydMhiu-oXHH_xo3hWvK6FHeLw/edit?gid=1967921723#gid=1967921723)

---

### Pull Request
[https://github.com/CodeAnd-Co/App-Local-TracTech/pull/85](https://github.com/CodeAnd-Co/App-Local-TracTech/pull/85)