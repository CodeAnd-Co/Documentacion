---
title: "RF28: Modificar fórmula"
sidebar_position: 29
---

# RF28: Modificar fórmula


### Historia de Usuario

Yo como usuario quiero modificar la fórmula en el sistema para ajustar los cálculos según nuevos requerimientos.

  **Criterios de Aceptación:**
  - El sistema debe permitir modificar la fórmula sin afectar los cálculos previos.
  - Los cambios deben reflejarse en los reportes generados.

---

### Diagrama de Secuencia

#### Frontend

```mermaid
sequenceDiagram
    participant Usuario
    participant Script (modificarFormula.js)
    participant CasoUso (modificarFormula.js)
    participant API (formulaApi.js)
    participant Servidor

    Usuario->>Script (modificarFormula.js): Click en "Guardar fórmula"
    
    activate Script (modificarFormula.js)
    Script (modificarFormula.js)->>CasoUso (modificarFormula.js): modificarFormulaCasoUso(id, nombre, formula, nombreOriginal)
    deactivate Script (modificarFormula.js)
    activate CasoUso (modificarFormula.js) 
    alt Campos vacíos o inválidos
        rect pink
            CasoUso (modificarFormula.js)-->>Script (modificarFormula.js): mostrarAlerta('Error', ...)
            activate Script (modificarFormula.js)
            Script (modificarFormula.js)-->>Usuario: Muestra alerta de error de validación
            deactivate Script (modificarFormula.js)
        end
    else Nombre duplicado
        rect pink
            CasoUso (modificarFormula.js)-->>Script (modificarFormula.js): mostrarAlerta('Error', 'Ya existe una fórmula con ese nombre.')
            activate Script (modificarFormula.js)
            Script (modificarFormula.js)-->>Usuario: Muestra alerta de nombre duplicado
            deactivate Script (modificarFormula.js)
        end
    end

    CasoUso (modificarFormula.js)->>API (formulaApi.js): modificarFormula(id, nombre, formula, token)
    deactivate CasoUso (modificarFormula.js)
    activate API (formulaApi.js)
    API (formulaApi.js)--)Servidor: PUT /formulas/modificarFormula {id, nombre, formula}
    activate Servidor
    Servidor--)API (formulaApi.js): Respuesta JSON
    deactivate Servidor

    alt Modificación exitosa
        rect lightgreen
            API (formulaApi.js)-->>CasoUso (modificarFormula.js): { ok: true, ... }
            activate CasoUso (modificarFormula.js)
            CasoUso (modificarFormula.js)-->>Script (modificarFormula.js): mostrarAlerta('Fórmula modificada', ...)
            deactivate CasoUso (modificarFormula.js)
            activate Script (modificarFormula.js)
            Script (modificarFormula.js)-->>Usuario: Muestra alerta de éxito y recarga módulo
            deactivate Script (modificarFormula.js)
        end
    else Error de API/servidor
        rect pink
            API (formulaApi.js)-->>CasoUso (modificarFormula.js): { ok: false, mensaje }
            activate CasoUso (modificarFormula.js)
            CasoUso (modificarFormula.js)-->>Script (modificarFormula.js): mostrarAlerta('Error de conexión', mensaje)
            deactivate CasoUso (modificarFormula.js)
            activate Script (modificarFormula.js)
            Script (modificarFormula.js)-->>Usuario: Muestra alerta de error
            deactivate Script (modificarFormula.js)
        end
    else Error de red o excepción
        rect pink
            API (formulaApi.js)-->>CasoUso (modificarFormula.js): Lanza excepción
            deactivate API (formulaApi.js)
            activate CasoUso (modificarFormula.js)
            CasoUso (modificarFormula.js)-->>Script (modificarFormula.js): mostrarAlerta('Error', ...)
            deactivate CasoUso (modificarFormula.js)
            activate Script (modificarFormula.js)
            Script (modificarFormula.js)-->>Usuario: Muestra alerta de error inesperado
            deactivate Script (modificarFormula.js)
        end
    end
```

#### Backend

```mermaid
sequenceDiagram
    participant API
    participant Ruta as Ruta(Servidor)
    participant Controlador as Controlador(Servidor)
    participant Repositorio as Repositorio(Servidor)
    participant Modelo

    API->>Ruta: putModificaFormula(IdFormula)
    activate Ruta
    Ruta->>Controlador: putModificaFormula(IdFormula)
    activate Controlador
    Controlador->>Repositorio: putModificaFormula(IdFormula)
    activate Repositorio
    Repositorio->>Modelo: updateById(IdFormula)
    activate Modelo

    alt Caso exitoso
        rect Lightgreen
            Modelo ->> Repositorio: Regresa información de la Formula
            Repositorio ->> Controlador: Regresa información de la Formula
            Controlador ->> Ruta: Regresa información de la Formula
            Ruta ->> API: Regresa información de la Formula
        end
    else Formula no encontrada
        rect pink
            Modelo ->> Repositorio: Error 404: No se encontró la Formula
            deactivate Modelo
            Repositorio ->> Controlador: Error 404: No se encontró la Formula
            Controlador ->> Ruta: Error 404: No se encontró la Formula
            Ruta ->> API: Error 404: No se encontró la Formula
        end
    else Falla en el repositorio
        rect pink
            Repositorio --x Controlador: Error 500: Base de datos inaccesible
            deactivate Repositorio
            Controlador ->> Ruta: Error 500: Fallo en repositorio
            Ruta ->> API: Error 500: Fallo en repositorio
        end 
    else Falla en el controlador
        rect pink
            Controlador --x Ruta: Error 500: Fallo interno en el procesamiento
            deactivate Controlador
            Ruta ->> API: Error 500: Fallo interno del servidor
            deactivate Ruta
        end
    end
```

---

### Mockup

![Mockup]

> *Descripción*: El mockup representa la interfaz del sistema donde el usuario puede modificar una fórmula. Muestra los campos de edición y los botones de acción disponibles.

---

### Pruebas Unitarias

[Pruebas](https://docs.google.com/spreadsheets/d/1W-JW32dTsfI22-Yl5LydMhiu-oXHH_xo3hWvK6FHeLw/edit?gid=1593713986#gid=1593713986)

---

### Pull Request
[https://github.com/CodeAnd-Co/App-Local-TracTech/pull/85](https://github.com/CodeAnd-Co/App-Local-TracTech/pull/85)
