---
title: "RF35: Super Administrador Elimina Set de Cuotas"
sidebar_position: 37
---

# RF35: Super Administrador Elimina Set de Cuotas

**Última actualización:** 06 de marzo de 2025

---

## Historia de Usuario

Como administrador, quiero eliminar una set de cuotas que ya no es necesaria, asegurando que los empleados no puedan utilizarla para adquirir uniformes.

## **Criterios de Aceptación:**

1. El Super Administrador debe poder eliminar un set de cuotas existente.
2. El sistema debe confirmar que el set de cuotas ha sido eliminado correctamente.
3. Si el set de cuotas no existe, el sistema debe mostrar un mensaje indicando que no se puede eliminar.
4. La eliminación debe reflejarse de inmediato en la lista de sets de cuotas.

---

## **Diagrama de Secuencia**

> _Descripción_: El diagrama de secuencia muestra el proceso mediante el cual el Super Administrador elimina un set de cuotas y cómo el sistema confirma la eliminación.

```mermaid
sequenceDiagram
    actor SuperAdministrador as Super Administrador

    %% FRONTEND
    box Frontend
    participant ListaCuotas as Página: ListaCuotas.jsx
    participant RepoFront as RepositorioEliminarSetCuotas
    end

    %% API GATEWAY
    box API Gateway
    participant ApiGateway as Gateway/API
    end

    %% BACKEND
    box Backend
    participant Ruta as eliminarSetCuotas.routes.js
    participant APIKey as revisarApiKey
    participant JWT as autorizarToken
    participant Permisos as verificarPermisos
    participant Controlador as eliminarSetCuotas.controller.js
    participant Repositorio as eliminarSetCuotasRepositorio.js
    end

    %% BASE DE DATOS
    box BaseDeDatos
    participant RDS as MySQL RDS
    end

    %% FLUJO
    SuperAdministrador ->> ListaCuotas: Selecciona sets y da clic en "Eliminar"
    ListaCuotas ->> SuperAdministrador: Muestra PopUp de confirmación
    SuperAdministrador ->> ListaCuotas: Confirma acción
    ListaCuotas ->> RepoFront: llamar eliminarSetCuotas([ids])
    RepoFront ->> ApiGateway: POST /api/cuotas/eliminar-set-cuotas\n{ idsSetCuotas }

    ApiGateway ->> Ruta: Redirige solicitud

    %% Middlewares
    Ruta ->> APIKey: Validar API Key
    alt API Key inválida
        APIKey -->> Ruta: Retorna 400
        Ruta -->> ApiGateway: Error 400
        ApiGateway -->> ListaCuotas: Muestra error "API key inválida"
    else API Key válida
        APIKey ->> JWT: Validar JWT
        alt JWT inválido o expirado
            JWT -->> Ruta: Retorna 401
            Ruta -->> ApiGateway: Error 401
            ApiGateway -->> ListaCuotas: Muestra error "Token inválido"
        else JWT válido
            JWT ->> Permisos: Verificar permiso "ELIMINAR_SET_CUOTAS"
            alt Permiso denegado
                Permisos -->> Ruta: Retorna 403
                Ruta -->> ApiGateway: Error 403
                ApiGateway -->> ListaCuotas: Muestra error "Permiso denegado"
            else Permiso válido
                Ruta ->> Controlador: eliminarSetCuotas({ idsSetCuotas })

                %% Proceso en repositorio
                loop por cada idSetCuota
                    Controlador ->> Repositorio: eliminarSetCuotas(idSetCuota)
                    Repositorio ->> RDS: DELETE FROM cuota_set_producto WHERE idCuotaSet = ?
                    Repositorio ->> RDS: DELETE FROM cuota_set WHERE idCuotaSet = ?
                    alt No existe id
                        RDS -->> Repositorio: affectedRows = 0
                        Repositorio -->> Controlador: throw Error "Set de cuotas no encontrado"
                        Controlador -->> Ruta: Retorna 404
                        Ruta -->> ApiGateway: Error 404
                        ApiGateway -->> ListaCuotas: Muestra "Set de cuotas no encontrado"
                    else Eliminación exitosa
                        RDS -->> Repositorio: OK
                        Repositorio -->> Controlador: Resultado exitoso
                    end
                end

                Controlador -->> Ruta: Retorna 200 "Set de cuotas eliminado correctamente"
                Ruta -->> ApiGateway: Respuesta 200
                ApiGateway -->> ListaCuotas: Muestra toast "Set eliminado correctamente"
            end
        end
    end


```



---

## **Mockup**

> _Descripción_: El mockup muestra la interfaz donde el Super Administrador puede eliminar un set de cuotas.

![alt text](<imagenes/Eliminar_Set_Cuotas.png>)